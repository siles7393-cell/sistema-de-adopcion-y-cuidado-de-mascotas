<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Donar a un Refugio</title>
  <style>
    .formulario { max-width: 400px; margin: 40px auto; border: 1px solid #ccc; border-radius: 8px; padding: 20px; }
    .formulario label { display: block; margin-top: 10px; }
    .formulario input, .formulario select { width: 100%; padding: 6px; margin-top: 4px; }
    .formulario button { margin-top: 15px; width: 100%; }
    .modal { display: none; position: fixed; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    .modal-content { background: #fff; padding: 20px; border-radius: 5px; min-width: 320px; }
  </style>
</head>
<body>
  <h2 style="text-align:center;">Donar a un Refugio</h2>
  <form class="formulario" id="formDonar">
    <label>Selecciona un refugio:
      <select name="refugio_id" id="refugio_id" required>
        <option value="">Cargando refugios...</option>
      </select>
    </label>
    <label>Importe a donar:
      <input type="number" name="importe" min="1" step="0.01" required>
    </label>
    <button type="submit">Donar</button>
  </form>

  <div class="modal" id="modalTerminos">
    <div class="modal-content">
      <h3>Términos y Condiciones</h3>
      <p>
        El refugio receptor se compromete a utilizar la donación con responsabilidad y buena causa para el bienestar de las mascotas. 
        El mal uso de los fondos puede ser motivo de sanción y exclusión de la plataforma.
      </p>
      <button onclick="confirmarDonacion()">Acepto y Confirmo mi Donación</button>
      <button onclick="cerrarModal()">Cancelar</button>
    </div>
  </div>

  <script>
    let datosDonacion = null;


    fetch('listar_refugios.php')
      .then(res => res.json())
      .then(refugios => {
        const sel = document.getElementById('refugio_id');
        sel.innerHTML = '<option value="">Selecciona un refugio</option>';
        refugios.forEach(r => {
          sel.innerHTML += `<option value="${r.Id}">${r.NombreRefugio}</option>`;
        });
      });

    document.getElementById('formDonar').onsubmit = function(e) {
      e.preventDefault();
      datosDonacion = new FormData(this);
      document.getElementById('modalTerminos').style.display = 'flex';
    };

    function confirmarDonacion() {
      fetch('procesar_donacion.php', {
        method: 'POST',
        body: datosDonacion
      })
      .then(res => res.text())
      .then(msg => {
        alert(msg);
        cerrarModal();
        document.getElementById('formDonar').reset();
      });
    }

    function cerrarModal() {
      document.getElementById('modalTerminos').style.display = 'none';
    }

    window.onclick = function(event) {
      if (event.target == document.getElementById('modalTerminos')) {
        cerrarModal();
      }
    };
  </script>
  <a href="adoptante_index.html"><button>atras</button></a>
</body>
</html>